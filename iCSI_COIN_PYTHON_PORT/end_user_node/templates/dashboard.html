<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iCSI Coin Node</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Rajdhani:wght@500;600;700&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: '#000000',
                        surface: '#09090b', // Zinc 950
                        border: '#27272a',   // Zinc 800
                        primary: 'rgb(var(--color-primary) / <alpha-value>)',  // Dynamic Primary
                        secondary: '#06b6d4', // Cyan
                        muted: '#a1a1aa',    // Zinc 400
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        heading: ['Rajdhani', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            /* Default Purple */
            --color-primary: 168 85 247;
        }

        /* Custom Scrollbar to match Dark Theme */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3f3f46;
        }

        /* Hide Number Input Arrows */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <script>
        // Apply theme immediately to prevent flash
        const savedTheme = localStorage.getItem('theme-color');
        if (savedTheme) {
            document.documentElement.style.setProperty('--color-primary', savedTheme);
        }
    </script>
</head>

<body
    class="bg-background text-white font-sans min-h-screen min-w-[1280px] antialiased selection:bg-primary selection:text-black">

    <!-- Top Navigation Bar -->
    <nav class="max-w-[1400px] mx-auto px-6 pt-6 pb-2">
        <div class="bg-surface border border-border rounded-xl px-6 py-3 flex items-center justify-between shadow-lg">
            <div class="flex items-center gap-3">
                <span class="w-3 h-3 rounded-full bg-primary shadow-[0_0_12px_rgb(var(--color-primary))]"></span>
                <span class="font-heading font-bold text-lg uppercase tracking-widest text-white">iCSI Coin</span>
                <span class="text-zinc-600 text-xs font-mono ml-2">Node Dashboard</span>
            </div>
            <div class="flex items-center gap-2">
                <!-- Navigation Buttons -->
                <button onclick="openBeggarModal()"
                    class="px-4 py-2 rounded-lg bg-primary/10 border border-primary/40 text-primary font-bold text-xs uppercase tracking-wider hover:bg-primary/20 hover:border-primary/60 transition-all flex items-center gap-2">
                    üí∞ Beggars List
                    <span id="begMenuDot" class="hidden w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>
                </button>

                <a href="/secret"
                    class="px-4 py-2 rounded-lg bg-zinc-800 border border-zinc-700 text-zinc-300 font-bold text-xs uppercase tracking-wider hover:bg-zinc-700 hover:text-white transition-all flex items-center gap-2 whitespace-nowrap">
                    üïµÔ∏è Secret Message
                </a>

                <!-- Management Dropdown -->
                <div class="relative group">
                    <button
                        class="px-4 py-2 rounded-lg bg-zinc-800 border border-zinc-700 text-zinc-300 font-bold text-xs uppercase tracking-wider hover:bg-zinc-700 hover:text-white transition-all flex items-center gap-2">
                        üîó Dashboard Links
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <!-- Dropdown Menu -->
                    <div
                        class="absolute right-0 mt-2 w-56 bg-surface border border-border rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 transform origin-top-right">
                        <div class="py-1">
                            <button onclick="openModal('networkUplinkModal')"
                                class="block w-full text-left px-4 py-3 text-sm text-zinc-300 hover:bg-zinc-800 hover:text-white border-b border-zinc-800">
                                üì° Network Uplink
                            </button>
                            <button onclick="openDownloadMinerModal()"
                                class="block w-full text-left px-4 py-3 text-sm text-zinc-300 hover:bg-zinc-800 hover:text-white border-b border-zinc-800">
                                ‚õè Download Miner
                            </button>
                            <button onclick="openDataModal()"
                                class="block w-full text-left px-4 py-3 text-sm text-zinc-300 hover:bg-zinc-800 hover:text-white border-b border-zinc-800">
                                üíæ Node Data (Backup)
                            </button>
                            <a href="/api-docs"
                                class="block w-full text-left px-4 py-3 text-sm text-zinc-300 hover:bg-zinc-800 hover:text-white border-b border-zinc-800">
                                üìö API Info
                            </a>
                            <button onclick="openRpcConfigModal()"
                                class="block w-full text-left px-4 py-3 text-sm text-zinc-300 hover:bg-zinc-800 hover:text-white border-b border-zinc-800">
                                üîí RPC Auth
                            </button>
                            <button onclick="openThemeModal()"
                                class="block w-full text-left px-4 py-3 text-sm text-zinc-300 hover:bg-zinc-800 hover:text-white">
                                üé® Theme
                            </button>
                        </div>
                    </div>
                </div>
                <button onclick="window.location.href='/explorer'"
                    class="px-4 py-2 rounded-lg bg-primary/10 border border-primary/40 text-primary font-bold text-xs uppercase tracking-wider hover:bg-primary/20 hover:border-primary/60 transition-all flex items-center gap-2">
                    üì¶ Blockchain Explorer
                </button>
                <button onclick="logout()"
                    class="px-4 py-2 rounded-lg bg-red-900/10 border border-red-900/40 text-red-500 font-bold text-xs uppercase tracking-wider hover:bg-red-900/20 hover:border-red-900/60 transition-all ml-2">
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Layout: 3-Column Grid -->
    <div class="max-w-[1400px] min-w-[1280px] mx-auto grid grid-cols-[350px_1fr_400px] gap-8 p-6 pt-4 items-start">

        <!-- LEFT COLUMN: STATUS & CONTROLS -->
        <!-- LEFT COLUMN: STATUS & CONTROLS -->
        <aside class="space-y-6">

            <!-- Node Status Panel (Slid Up) -->

            <!-- Node Status Panel -->
            <div class="bg-surface border border-border rounded-xl p-6 shadow-sm">
                <h2
                    class="font-heading font-bold text-lg uppercase tracking-wider flex items-center gap-2 mb-6 text-white">
                    <span class="w-2 h-2 rounded-full bg-secondary shadow-[0_0_10px_#06b6d4]"></span> Node Status
                </h2>
                <div class="space-y-3 font-mono text-sm">
                    <div class="flex justify-between items-center py-2 border-b border-zinc-900">
                        <span class="text-zinc-500">Port</span>
                        <span class="text-white">{{ port }}</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-zinc-900">
                        <span class="text-zinc-500">Peers</span>
                        <span id="peerCount" class="text-primary">0</span>
                    </div>
                    <div class="flex justify-between items-center py-2">
                        <span class="text-zinc-500">Block Height</span>
                        <span id="blockHeight" class="text-secondary font-bold">0</span>
                    </div>
                </div>
            </div>

            <!-- Network Stats Panel -->
            <div class="bg-surface border border-border rounded-xl p-6 shadow-sm">
                <h2
                    class="font-heading font-bold text-lg uppercase tracking-wider flex items-center gap-2 mb-6 text-white">
                    <span class="w-2 h-2 rounded-full bg-purple-500 shadow-[0_0_10px_#a855f7]"></span> Blockchain Info
                </h2>
                <div class="space-y-3 font-mono text-sm">
                    <div class="flex justify-between items-center py-2 border-b border-zinc-900">
                        <span class="text-zinc-500">Difficulty</span>
                        <span id="netDiff" class="text-white">---</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-zinc-900">
                        <span class="text-zinc-500">Next Diff. Increase</span>
                        <span id="netDiffCountdown" class="text-white">---</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-zinc-900">
                        <span class="text-zinc-500">Reward</span>
                        <span id="netReward" class="text-primary">---</span>
                    </div>
                    <div class="flex justify-between items-center py-2">
                        <span class="text-zinc-500">Halving In</span>
                        <span id="netHalving" class="text-white">---</span>
                    </div>
                </div>
            </div>

        </aside>

        <!-- COLUMN 3: WALLET & FEED -->
        <main class="space-y-6">

            <!-- Wallet Panel -->
            <div class="bg-surface border border-border rounded-xl p-6 relative overflow-hidden shadow-lg">

                <div class="flex items-center justify-between mb-6">
                    <h2 class="font-heading font-bold text-xl uppercase tracking-wider text-white">My Wallet</h2>
                    <div class="flex gap-2">
                        <select id="walletSelect" onchange="updateWalletDisplay()"
                            class="bg-black border border-border text-xs rounded-lg px-3 py-2 focus:outline-none focus:border-secondary transition-colors text-zinc-300">
                            <option>Loading...</option>
                        </select>
                        <button onclick="openManageWallet()"
                            class="px-3 py-1.5 rounded-lg bg-zinc-800 border border-zinc-700 text-[10px] font-bold uppercase tracking-wider text-zinc-400 hover:text-primary hover:border-primary/50 transition-colors"
                            title="Manage Wallet">Manage</button>
                        <button onclick="purgeWallet()"
                            class="p-2 rounded-lg text-zinc-500 hover:text-pink-500 hover:bg-pink-500/10 transition-colors"
                            title="Purge Wallet">‚úï</button>
                    </div>
                </div>

                <div class="text-center mb-6 py-6 bg-black rounded-xl border border-border">
                    <div class="relative inline-block">
                        <span id="currentBalance"
                            class="block text-4xl md:text-5xl font-bold font-heading text-primary tracking-tighter drop-shadow-[0_0_15px_rgba(168,85,247,0.3)]">0.00</span>
                        <span
                            class="absolute -bottom-4 right-0 text-[10px] font-mono text-zinc-500 tracking-widest">ICSI</span>
                    </div>
                    <div class="mt-4 flex justify-center">
                        <input type="text" id="currentAddress" readonly value="---"
                            class="font-mono text-[10px] text-zinc-600 bg-zinc-900 px-3 py-1 rounded border border-zinc-800 w-full text-center hover:text-white transition-colors cursor-pointer focus:outline-none focus:border-primary/50">
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-3 mb-8">
                    <button onclick="openCreateWalletModal()"
                        class="py-2.5 bg-zinc-900 border border-zinc-800 rounded-lg text-xs font-bold uppercase text-muted hover:text-white hover:border-zinc-600 hover:bg-zinc-800 transition-all shadow-sm">Create
                        New</button>
                    <button onclick="exportWallets()"
                        class="py-2.5 bg-zinc-900 border border-zinc-800 rounded-lg text-xs font-bold uppercase text-muted hover:text-white hover:border-zinc-600 hover:bg-zinc-800 transition-all shadow-sm">Export</button>
                    <button onclick="openImportWalletModal()"
                        class="py-2.5 bg-zinc-900 border border-zinc-800 rounded-lg text-xs font-bold uppercase text-muted hover:text-white hover:border-zinc-600 hover:bg-zinc-800 transition-all shadow-sm">Import</button>
                </div>

                <div class="bg-black/50 rounded-xl p-6 border border-zinc-900">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-zinc-600 mb-2 font-heading tracking-wider">Recipient
                                Address</label>
                            <input type="text" id="sendTo" placeholder="Paste address..."
                                class="w-full bg-black border border-border rounded-lg px-3 py-2 text-sm focus:border-primary focus:outline-none text-white">
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-zinc-600 mb-2 font-heading tracking-wider">Amount</label>
                            <input type="number" id="sendAmount" placeholder="0.00"
                                class="w-full bg-black border border-border rounded-lg px-3 py-2 text-sm focus:border-primary focus:outline-none text-white">
                        </div>
                    </div>
                    <button onclick="sendCoin()"
                        class="w-full py-3 bg-zinc-800 hover:bg-zinc-700 text-white font-bold uppercase text-xs rounded-lg tracking-wider transition-colors shadow-md">
                        Send Transaction
                    </button>
                    <div id="sendResult" class="mt-3 text-center text-xs font-mono text-zinc-500 min-h-[1rem]">
                    </div>
                </div>
            </div>

            <!-- Mining Panel -->
            <div class="bg-surface border border-border rounded-xl p-6 shadow-sm">
                <h2
                    class="font-heading font-bold text-lg uppercase tracking-wider flex items-center gap-2 mb-6 text-white">
                    <span class="w-2 h-2 rounded-full bg-primary shadow-[0_0_10px_rgb(var(--color-primary))]"></span>
                    Mining
                    Operations
                </h2>

                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <select id="miningTargetSelect"
                        class="flex-1 bg-black border border-border rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-purple-500 text-white">
                        <!-- Options -->
                    </select>
                    <div class="flex gap-2">
                        <button id="startMineBtn" onclick="startMining()"
                            class="px-6 py-2 bg-primary hover:bg-primary/80 text-black font-bold uppercase text-xs rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-[0_0_15px_rgba(var(--color-primary),0.3)]">Start</button>
                        <button id="stopMineBtn" onclick="stopMining()" disabled
                            class="px-6 py-2 bg-red-500/10 border border-red-500/50 text-red-500 hover:bg-red-500/20 font-bold uppercase text-xs rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Stop</button>
                    </div>
                </div>
                <div class="mb-4 text-right">
                    <button onclick="checkMinerAuth()"
                        class="text-[10px] text-zinc-500 hover:text-white underline decoration-zinc-700 hover:decoration-white transition-all">Does
                        my miner accept Auth?</button>
                </div>

                <div id="miningTerminal"
                    class="h-48 bg-black border border-border rounded-lg p-4 font-mono text-xs text-zinc-400 overflow-y-auto">
                    <div class="mb-1 text-zinc-600">> System Ready...</div>
                </div>
            </div>
        </main>

        <!-- RIGHT COLUMN: PEERS & LOGS -->
        <aside class="space-y-6">
            <div class="bg-surface border border-border rounded-xl p-6 shadow-sm">
                <h2
                    class="font-heading font-bold text-lg uppercase tracking-wider flex items-center gap-2 mb-6 text-white shrink-0">
                    <span class="w-2 h-2 rounded-full bg-cyan-500 shadow-[0_0_10px_#06b6d4]"></span> Network Peers
                </h2>

                <input type="text" id="peerSearch" placeholder="Filter Peers..." onkeyup="filterPeers()"
                    class="w-full bg-black border border-border rounded-lg px-4 py-3 text-sm mb-4 focus:border-blue-500 focus:outline-none shrink-0 text-white placeholder-zinc-700">

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="sticky top-0 bg-surface z-10 shadow-sm">
                            <tr>
                                <th
                                    class="pb-3 pl-2 text-xs font-bold text-zinc-500 uppercase tracking-wider font-heading">
                                    IP</th>
                                <th class="pb-3 text-xs font-bold text-zinc-500 uppercase tracking-wider font-heading">
                                    Port</th>
                                <th
                                    class="pb-3 pr-2 text-xs font-bold text-zinc-500 uppercase tracking-wider text-right font-heading">
                                    Action</th>
                            </tr>
                        </thead>
                        <tbody id="peerTableBody" class="font-mono text-sm text-zinc-300 divide-y divide-zinc-900">
                            <!-- JS populated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </aside>

    </div>

    <!-- MODALS (Tailwind) -->
    <div id="createWalletModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-surface border border-border rounded-xl p-8 w-[90%] max-w-md shadow-2xl animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-heading font-bold text-xl uppercase text-white">New Wallet</h3>
                <button onclick="closeModal('createWalletModal')"
                    class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>
            <input type="text" id="newWalletName" placeholder="Wallet Name"
                class="w-full bg-black border border-border rounded-lg px-4 py-3 mb-6 focus:border-primary focus:outline-none text-white">
            <button onclick="createWallet()"
                class="w-full py-3 bg-primary text-black font-bold uppercase text-sm rounded-full hover:bg-[#9333ea] transition-colors shadow-[0_0_20px_rgba(168,85,247,0.2)]">Generate
                Keys</button>
        </div>
    </div>

    <div id="importWalletModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-surface border border-border rounded-xl p-8 w-[90%] max-w-md shadow-2xl animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-heading font-bold text-xl uppercase text-white">Import Wallet</h3>
                <button onclick="closeModal('importWalletModal')"
                    class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>

            <!-- File Upload -->
            <label
                class="block w-full cursor-pointer mb-4 border-2 border-dashed border-zinc-700 hover:border-primary rounded-xl p-6 text-center transition-colors group">
                <input type="file" id="importFile" accept=".json" class="hidden" onchange="handleImportFile(this)">
                <div class="text-zinc-500 group-hover:text-primary transition-colors">
                    <span class="block text-2xl mb-1">üìÇ</span>
                    <span class="text-xs font-bold uppercase tracking-wider">Choose JSON File</span>
                </div>
                <div id="importFileName" class="mt-2 text-[10px] font-mono text-cyan-400 hidden"></div>
            </label>

            <!-- Divider -->
            <div class="flex items-center gap-3 mb-4">
                <div class="flex-1 h-px bg-zinc-800"></div>
                <span class="text-[10px] text-zinc-600 font-bold uppercase tracking-widest">or paste JSON</span>
                <div class="flex-1 h-px bg-zinc-800"></div>
            </div>

            <textarea id="importData" rows="4"
                class="w-full bg-black border border-border rounded-lg px-4 py-3 mb-6 font-mono text-xs focus:border-primary focus:outline-none text-white"
                placeholder='Paste JSON data...'></textarea>
            <button onclick="importWallets()"
                class="w-full py-3 bg-primary text-black font-bold uppercase text-sm rounded-full hover:bg-[#9333ea] transition-colors shadow-[0_0_20px_rgba(168,85,247,0.2)]">Import</button>
        </div>
    </div>

    <div id="logModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-surface border border-border rounded-xl p-0 w-[95%] max-w-7xl h-[85vh] flex flex-col shadow-2xl overflow-hidden animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center p-6 border-b border-border bg-black">
                <h3 id="logModalTitle" class="font-heading font-bold text-xl uppercase text-primary">Peer Logs</h3>
                <button onclick="closeModal('logModal')" class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>
            <div id="logSummary" class="px-6 py-3 bg-zinc-950 border-b border-border font-mono text-xs flex gap-6">
                <span class="text-zinc-500">Number of Blocks Seen Here: <span id="logBlockCount"
                        class="text-cyan-400 font-bold">0</span></span>
            </div>
            <div id="logContent"
                class="flex-1 overflow-y-auto p-6 font-mono text-xs text-zinc-400 whitespace-pre-wrap bg-[#050505]">
            </div>
        </div>
    </div>

    <!-- Unified Beggar Modal -->
    <div id="beggarListModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-surface border border-border rounded-xl p-0 w-[95%] max-w-3xl h-[80vh] flex flex-col shadow-2xl overflow-hidden animate-[slideUp_0.3s_ease-out]">
            <!-- Header -->
            <div class="flex justify-between items-center p-6 border-b border-border bg-black">
                <h3 class="font-heading font-bold text-xl uppercase text-yellow-400">üí∞ Recipients / Beggars</h3>
                <button onclick="closeModal('beggarListModal')"
                    class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>

            <!-- Begging Controls -->
            <div class="px-6 py-4 bg-zinc-950 border-b border-border space-y-3">
                <!-- Active Beg Status -->
                <div id="begStatus"
                    class="hidden px-4 py-3 rounded-lg bg-yellow-950/40 border border-yellow-800/40 font-mono text-xs">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2 text-yellow-400">
                            <span class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>
                            <span>Begging Active ‚Äî <span id="begTimer">20:00</span> remaining</span>
                        </div>
                        <button onclick="stopBegging()" id="stopBegBtn"
                            class="px-3 py-1 rounded-md border border-yellow-800/50 text-yellow-500 font-bold text-[10px] uppercase hover:bg-yellow-950/50 transition-all">
                            ‚úã Stop
                        </button>
                    </div>
                    <div id="begAddress" class="text-yellow-600 text-[10px] mt-1 truncate"></div>
                </div>

                <!-- Start Begging Controls -->
                <div id="begStartSection" class="flex items-center gap-3">
                    <select id="begWalletSelect"
                        class="flex-1 bg-black border border-border rounded-lg px-3 py-2 text-xs font-mono text-white focus:outline-none focus:border-primary transition-colors">
                        <option value="">Select Wallet to Advertise...</option>
                    </select>
                    <button onclick="startBegging()"
                        class="px-5 py-2 rounded-lg bg-yellow-600 text-black font-bold text-xs uppercase tracking-wider hover:bg-yellow-500 active:scale-[0.98] transition-all whitespace-nowrap">
                        üí∞ Beg for Coins
                    </button>
                </div>
            </div>

            <!-- Subtitle -->
            <div class="px-6 py-2 border-b border-border font-mono text-[10px] text-zinc-600 uppercase tracking-widest">
                Network Beggars ‚Äî click address to copy
            </div>

            <!-- Beggar List Content -->
            <div id="beggarListContent" class="flex-1 overflow-y-auto p-6 space-y-3">
                <div class="text-zinc-500 text-sm font-mono text-center py-8">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Manage Wallet Modal -->
    <div id="manageWalletModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-50">
        <div
            class="bg-surface border border-border rounded-xl p-8 w-[95%] max-w-xl shadow-2xl animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-8">
                <h3 class="font-heading font-bold text-3xl uppercase text-white tracking-wider">Manage Wallet</h3>
                <button onclick="closeModal('manageWalletModal')"
                    class="text-zinc-500 hover:text-white text-3xl transition-colors">‚úï</button>
            </div>

            <!-- Wallet Info -->
            <div class="bg-black rounded-xl border border-border p-8 mb-8 space-y-6">
                <!-- Name Section -->
                <div class="flex justify-between items-center group">
                    <span class="text-sm font-bold uppercase tracking-widest text-zinc-500">Wallet Name</span>
                    <div id="manageNameView" class="flex items-center gap-4">
                        <span id="manageWalletName" class="text-2xl font-bold text-white tracking-wide"></span>
                        <button onclick="showRenameField()"
                            class="px-3 py-1 bg-zinc-900 hover:bg-zinc-800 text-xs text-primary font-bold uppercase tracking-wider rounded-lg border border-zinc-800 transition-all">
                            Rename
                        </button>
                    </div>
                    <div id="manageNameEdit" class="hidden flex flex-col gap-2 items-start w-full mt-2">
                        <input type="text" id="renameInput"
                            class="bg-zinc-900 border border-border rounded-lg px-4 py-2 text-lg focus:border-primary focus:outline-none text-white w-full placeholder-zinc-700">
                        <div class="flex gap-2 w-full">
                            <button onclick="saveWalletName()"
                                class="flex-1 bg-primary text-black px-4 py-2 rounded-lg font-bold uppercase hover:bg-[#9333ea] transition-colors shadow-lg shadow-primary/20 text-sm">
                                Save
                            </button>
                            <button onclick="cancelRename()"
                                class="flex-1 bg-zinc-800 text-zinc-400 hover:text-white font-bold uppercase px-4 py-2 rounded-lg border border-zinc-700 hover:bg-zinc-700 transition-colors text-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="h-px bg-zinc-900/50"></div>

                <!-- Balance Section -->
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold uppercase tracking-widest text-zinc-500">Balance</span>
                    <div class="text-right">
                        <span id="manageWalletBalance" class="text-3xl font-bold text-primary font-mono block"></span>
                        <span class="text-xs text-zinc-600 font-mono uppercase tracking-widest">Available Funds</span>
                    </div>
                </div>

                <div class="h-px bg-zinc-900/50"></div>

                <!-- Address Section -->
                <div>
                    <span class="text-sm font-bold uppercase tracking-widest text-zinc-500 block mb-3">Wallet
                        Address</span>
                    <div class="relative group cursor-pointer" title="Click to Copy">
                        <span id="manageWalletAddr"
                            class="block w-full bg-zinc-900/50 border border-zinc-800 rounded-lg p-4 font-mono text-sm text-zinc-300 break-all select-all hover:text-white hover:border-primary/50 transition-all"></span>
                        <span
                            class="absolute top-2 right-2 text-xs text-zinc-500 opacity-0 group-hover:opacity-100 transition-opacity">Copy</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RPC Config Modal -->
    <div id="rpcConfigModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-zinc-900 border border-zinc-700 rounded-xl p-8 w-[90%] max-w-md shadow-2xl animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-heading font-bold text-xl uppercase text-white">RPC Authentication</h3>
                <button onclick="closeModal('rpcConfigModal')" class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>

            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-xs font-bold uppercase text-zinc-500 mb-2 tracking-wider">Username</label>
                    <input type="text" id="rpcUser"
                        class="w-full bg-black border border-zinc-700 rounded-lg px-4 py-3 text-sm focus:border-cyan-500 focus:outline-none text-white">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-zinc-500 mb-2 tracking-wider">Password</label>
                    <input type="text" id="rpcPass"
                        class="w-full bg-black border border-zinc-700 rounded-lg px-4 py-3 text-sm focus:border-cyan-500 focus:outline-none text-white">
                </div>
                <div class="flex items-center gap-3 py-2">
                    <input type="checkbox" id="rpcEnforce"
                        class="w-4 h-4 rounded border-gray-300 text-cyan-500 focus:ring-cyan-500">
                    <label for="rpcEnforce" class="text-sm text-zinc-300 select-none cursor-pointer">Enforce
                        Username/Password</label>
                </div>
                <p class="text-[10px] text-zinc-500 font-mono leading-relaxed border-l-2 border-yellow-600 pl-3">
                    <span class="text-yellow-600 font-bold">WARNING:</span> If enforced, external miners must specify
                    <code>--user</code> and <code>--pass</code> arguments matching these credentials.
                </p>
            </div>

            <button onclick="saveRpcConfig()"
                class="w-full py-3 bg-cyan-600 text-white font-bold uppercase text-sm rounded-lg hover:bg-cyan-500 transition-colors shadow-[0_0_20px_rgba(8,145,178,0.2)]">
                Save Configuration
            </button>
        </div>
    </div>

    <!-- Download Miner Modal -->
    <div id="downloadMinerModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-zinc-900 border border-zinc-700 rounded-xl p-8 w-[95%] max-w-2xl shadow-2xl animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-heading font-bold text-xl uppercase text-white">Download Standalone Miner</h3>
                <button onclick="closeModal('downloadMinerModal')"
                    class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>

            <div class="space-y-6">
                <div class="bg-black/50 p-4 rounded-lg border border-zinc-800">
                    <p class="text-sm text-zinc-300 mb-2">1. Download the miner package (includes Python script &
                        library):</p>
                    <a href="/api/miner/download"
                        class="inline-block px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-lg transition-colors">
                        üì• Download ZIP
                    </a>
                </div>

                <div>
                    <p class="text-sm text-zinc-300 mb-2">2. Prepare Python Environment:</p>
                    <pre
                        class="bg-black border border-zinc-800 rounded p-4 text-xs font-mono text-zinc-400 overflow-x-auto"><code><span class="text-purple-400"># Unzip the file</span>
unzip icsi_miner.zip
cd icsi_miner

<span class="text-purple-400"># Create Virtual Environment</span>
python3 -m venv venv
source venv/bin/activate  <span class="text-zinc-600"># On Windows: venv\Scripts\activate</span>

<span class="text-purple-400"># Install Dependencies</span>
pip install -r requirements.txt</code></pre>
                </div>

                <div>
                    <p class="text-sm text-zinc-300 mb-2">3. Start Mining:</p>
                    <pre
                        class="bg-black border border-zinc-800 rounded p-4 text-xs font-mono text-zinc-400 overflow-x-auto"><code id="minerCommand">python3 miner.py --url http://127.0.0.1:9342 --user user --pass pass</code></pre>
                    <p class="text-[10px] text-zinc-500 mt-2 font-mono">
                        <span class="text-purple-400">üí° Tip:</span> Add <code>--address &lt;YOUR_WALLET&gt;</code> to
                        mine rewards directly to your wallet!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Uplink Modal (Moved from Dashboard Card) -->
    <div id="networkUplinkModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-surface border border-border rounded-xl p-8 w-[95%] max-w-lg shadow-2xl animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-heading font-bold text-xl uppercase text-white">
                    <span class="w-2 h-2 rounded-full bg-primary shadow-[0_0_10px_#a855f7] inline-block mr-2"></span>
                    Network Uplink
                </h3>
                <button onclick="closeModal('networkUplinkModal')"
                    class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>

            <div id="uplinkStatus"
                class="w-full py-3 rounded-lg text-center font-bold tracking-widest text-sm mb-6 bg-black border border-zinc-900 text-zinc-500 border-zinc-900">
                OFFLINE
            </div>

            <form id="connectionFormModal" class="space-y-4">
                <div>
                    <label
                        class="block font-heading font-bold text-xs uppercase tracking-widest text-muted mb-2">Manually
                        Add Another Node <span class="text-zinc-600">(Optional)</span></label>
                    <div class="flex gap-2">
                        <input type="text" id="seedIp" placeholder="Node IP Address" value="{{ seed_ip }}"
                            class="flex-1 bg-black border border-border rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary transition-colors placeholder-zinc-700 text-white">
                        <input type="number" id="seedPort" placeholder="9341" value="9341"
                            class="w-24 bg-black border border-border rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary transition-colors placeholder-zinc-700 text-white">
                    </div>
                    <p class="text-[10px] text-zinc-600 mt-2 font-mono">Default Port: 9341 (User Node)</p>
                    <div id="discoveryStatus" class="mt-2 flex items-center gap-2 text-[11px] font-mono text-zinc-500">
                        <span class="inline-block w-2 h-2 rounded-full bg-zinc-700 animate-pulse"
                            id="discoveryDot"></span>
                        <span id="discoveryText">Scanning for peers...</span>
                    </div>
                </div>

                <button type="button" id="connectBtn" onclick="connectToNetwork()"
                    class="w-full py-2 rounded-full bg-primary text-black font-bold text-xs uppercase tracking-wider shadow-[0_0_20px_rgba(168,85,247,0.15)] hover:bg-[#9333ea] active:scale-[0.98] transition-all">
                    Add Node
                </button>

                <div class="h-px bg-zinc-900 my-6"></div>

                <div>
                    <label class="block font-heading font-bold text-xs uppercase tracking-widest text-muted mb-2">
                        STUN Server Configuration <span class="text-zinc-600">(Advanced)</span>
                    </label>
                    <div class="flex gap-2">
                        <input type="text" id="stunIp" placeholder="STUN IP" value="{{ stun_ip }}"
                            class="flex-1 bg-black border border-border rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary transition-colors text-white placeholder-zinc-700">
                        <input type="number" id="stunPort" placeholder="3478" value="3478"
                            class="w-24 bg-black border border-border rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary transition-colors text-white placeholder-zinc-700">
                    </div>
                    <button type="button" onclick="setStunServer()"
                        class="w-full mt-2 py-2 rounded-full border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800 font-bold text-xs uppercase tracking-wider transition-all">
                        Set STUN Server
                    </button>
                    <div id="stunStatus" class="mt-2 text-[10px] font-mono text-center min-h-[1rem]"></div>
                </div>

                <div class="h-px bg-zinc-900 my-6"></div>

                <div>
                    <label class="block font-heading font-bold text-xs uppercase tracking-widest text-muted mb-4">NAT
                        Diagnostics & Warning</label>
                    <button type="button" onclick="testNat()"
                        class="w-full py-3 rounded-xl border border-border text-muted font-bold text-xs uppercase hover:text-white hover:bg-zinc-900 transition-colors mb-4">
                        Test NAT Discovery
                    </button>

                    <div class="space-y-4">
                        <blockquote class="p-4 border-l-4 border-purple-500 bg-purple-900/10 rounded-r-lg">
                            <p class="text-sm italic text-zinc-300 leading-relaxed font-serif">
                                "Placing this node on the public internet unleashes its peer-to-peer nature, potentially
                                causing your blockchain to take on a life of its own. Once public, you will own the
                                chain as
                                much as Satoshi Nakamoto owns Bitcoin‚Äîwhich is to say, not at all."
                            </p>
                        </blockquote>

                        <div class="grid grid-cols-1 gap-3">
                            <div class="p-3 border border-red-900/50 bg-red-900/10 rounded-lg">
                                <p class="text-xs text-red-300 font-bold leading-tight">
                                    Just don't point it at or host it directly on a 'public' IP and you'll be fine.
                                </p>
                            </div>
                            <div class="p-3 border border-cyan-900/50 bg-cyan-900/10 rounded-lg">
                                <p class="text-xs text-cyan-300 font-bold leading-tight">
                                    Hosting this in a LAN is the best way to <u class="text-white">not</u>
                                    'accidentally' become the creator of the next
                                    big crypto breakout coin.
                                </p>
                            </div>
                        </div>

                        <div class="text-center pt-2">
                            <p
                                class="text-sm font-heading font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 uppercase tracking-widest">
                                Remember, friends don't let friends become crypto bros!
                            </p>
                        </div>
                    </div>

                    <div id="natResult" class="mt-4 text-xs font-mono text-zinc-500 break-all text-center"></div>
                </div>
            </form>
        </div>
    </div>

    <!-- Your Data Modal -->
    <div id="dataModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50">
        <div
            class="bg-zinc-900 border border-zinc-700 rounded-xl p-8 w-[95%] max-w-lg shadow-2xl animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-heading font-bold text-xl uppercase text-white">Your Node Data</h3>
                <button onclick="closeModal('dataModal')" class="text-zinc-500 hover:text-white text-xl">‚úï</button>
            </div>

            <div class="space-y-6">
                <div class="bg-blue-900/20 p-4 rounded-lg border border-blue-800/50">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">üíæ</span>
                        <div>
                            <h4 class="text-blue-400 font-bold mb-1">Full Data Backup</h4>
                            <p class="text-sm text-zinc-400">
                                This archive contains your entire node state:
                            </p>
                            <ul class="list-disc list-inside text-xs text-zinc-500 mt-2 space-y-1">
                                <li><strong>wallet_export.json</strong>: Importable JSON key export</li>
                                <li><strong>wallet.dat</strong>: Raw wallet file (Sensitive!)</li>
                                <li><strong>blocks/</strong>: Blockchain history</li>
                                <li><strong>chainstate.sqlite</strong>: UTXO database</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="bg-red-900/20 p-4 rounded-lg border border-red-800/50 flex items-center gap-3">
                    <span class="text-red-400 text-xl">‚ö†Ô∏è</span>
                    <p class="text-xs text-red-300">
                        <strong>Warning:</strong> This file contains your PRIVATE KEYS. <br>
                        Do not share this file with anyone!
                    </p>
                </div>

                <a href="/api/data/download"
                    class="block w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold text-center rounded-lg transition-colors">
                    Download Archive (.zip)
                </a>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js?v=8"></script>
    <!-- Theme Selection Modal -->
    <div id="themeModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-50 opacity-0 transition-opacity duration-300">
        <div class="bg-surface border border-border p-8 rounded-2xl shadow-2xl max-w-2xl w-full transform scale-95 transition-transform duration-300"
            id="themeModalContent">
            <h2 class="text-2xl font-bold font-heading mb-2 text-white text-center">Select Theme</h2>
            <p class="text-muted text-sm mb-6 text-center">Choose a color palette for the dashboard.</p>

            <div class="grid grid-cols-5 gap-4 mb-6 max-h-[60vh] overflow-y-auto p-1">
                <!-- Purple (Default) -->
                <button onclick="setTheme('168 85 247')"
                    class="group relative w-full aspect-square rounded-xl bg-purple-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-purple-500">
                    <span class="sr-only">Purple</span>
                    <span
                        class="absolute inset-0 flex items-center justify-center opacity-0 group-[.active]:opacity-100">
                        <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                    </span>
                </button>
                <!-- Indigo -->
                <button onclick="setTheme('99 102 241')"
                    class="group relative w-full aspect-square rounded-xl bg-indigo-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-indigo-500">
                    <span class="sr-only">Indigo</span>
                </button>
                <!-- Blue -->
                <button onclick="setTheme('59 130 246')"
                    class="group relative w-full aspect-square rounded-xl bg-blue-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-blue-500">
                    <span class="sr-only">Blue</span>
                </button>
                <!-- Sky -->
                <button onclick="setTheme('14 165 233')"
                    class="group relative w-full aspect-square rounded-xl bg-sky-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-sky-500">
                    <span class="sr-only">Sky</span>
                </button>
                <!-- Cyan -->
                <button onclick="setTheme('6 182 212')"
                    class="group relative w-full aspect-square rounded-xl bg-cyan-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-cyan-500">
                    <span class="sr-only">Cyan</span>
                </button>

                <!-- Teal -->
                <button onclick="setTheme('20 184 166')"
                    class="group relative w-full aspect-square rounded-xl bg-teal-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-teal-500">
                    <span class="sr-only">Teal</span>
                </button>
                <!-- Emerald -->
                <button onclick="setTheme('16 185 129')"
                    class="group relative w-full aspect-square rounded-xl bg-emerald-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-emerald-500">
                    <span class="sr-only">Emerald</span>
                </button>
                <!-- Green -->
                <button onclick="setTheme('34 197 94')"
                    class="group relative w-full aspect-square rounded-xl bg-green-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-green-500">
                    <span class="sr-only">Green</span>
                </button>
                <!-- Lime -->
                <button onclick="setTheme('132 204 22')"
                    class="group relative w-full aspect-square rounded-xl bg-lime-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-lime-500">
                    <span class="sr-only">Lime</span>
                </button>
                <!-- Yellow -->
                <button onclick="setTheme('234 179 8')"
                    class="group relative w-full aspect-square rounded-xl bg-yellow-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-yellow-500">
                    <span class="sr-only">Yellow</span>
                </button>

                <!-- Amber -->
                <button onclick="setTheme('245 158 11')"
                    class="group relative w-full aspect-square rounded-xl bg-amber-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-amber-500">
                    <span class="sr-only">Amber</span>
                </button>
                <!-- Orange -->
                <button onclick="setTheme('249 115 22')"
                    class="group relative w-full aspect-square rounded-xl bg-orange-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-orange-500">
                    <span class="sr-only">Orange</span>
                </button>
                <!-- Red -->
                <button onclick="setTheme('239 68 68')"
                    class="group relative w-full aspect-square rounded-xl bg-red-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-red-500">
                    <span class="sr-only">Red</span>
                </button>
                <!-- Rose -->
                <button onclick="setTheme('244 63 94')"
                    class="group relative w-full aspect-square rounded-xl bg-rose-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-rose-500">
                    <span class="sr-only">Rose</span>
                </button>
                <!-- Pink -->
                <button onclick="setTheme('236 72 153')"
                    class="group relative w-full aspect-square rounded-xl bg-pink-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-pink-500">
                    <span class="sr-only">Pink</span>
                </button>

                <!-- Fuchsia -->
                <button onclick="setTheme('217 70 239')"
                    class="group relative w-full aspect-square rounded-xl bg-fuchsia-500 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-fuchsia-500">
                    <span class="sr-only">Fuchsia</span>
                </button>
                <!-- Slate (Monochrome) -->
                <button onclick="setTheme('148 163 184')"
                    class="group relative w-full aspect-square rounded-xl bg-slate-400 hover:scale-105 transition-all border-2 border-transparent hover:border-white focus:outline-none ring-offset-2 ring-offset-surface focus:ring-2 focus:ring-slate-400">
                    <span class="sr-only">Slate</span>
                </button>
            </div>

            <div class="flex justify-end">
                <button onclick="closeThemeModal()"
                    class="px-6 py-2 rounded-lg bg-zinc-800 text-white font-bold hover:bg-zinc-700 transition-all">
                    Close
                </button>
            </div>
        </div>
    </div>
</body>

</html>