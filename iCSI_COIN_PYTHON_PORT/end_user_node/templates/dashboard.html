<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iCSI Coin Node</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Modern Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="main-layout">
        <!-- LEFT COLUMN: NETWORK UPLINK -->
        <div class="column left-col">
            <div class="panel">
                <div class="panel-header">Network Uplink</div>
                <div class="panel-body">
                    <div class="status-indicator" id="uplinkStatus">OFFLINE</div>

                    <form id="connectionForm">
                        <div class="input-group">
                            <label>Initial Seed IP</label>
                            <input type="text" id="seedIp" name="seed_ip" placeholder="192.168.X.X"
                                value="{{ seed_ip }}">
                            <div class="help-text">Auto-connects to Ports 9333-9335</div>
                        </div>

                        <div class="actions">
                            <button type="button" class="btn primary" onclick="connectToNetwork()">Initialize
                                Network</button>
                        </div>

                        <div class="separator"></div>

                        <div class="input-group">
                            <label>NAT Diagnostics</label>
                            <div class="help-text">STUN: Port 3478 (Enforced)</div>
                        </div>
                        <div class="actions">
                            <button type="button" class="btn secondary" onclick="testNat()">Test NAT Discovery</button>
                        </div>
                        <div id="natResult" class="console-output small"></div>
                    </form>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">Node Status</div>
                <div class="panel-body">
                    <div class="stat-row">
                        <span>Port</span> <span class="val">{{ port }}</span>
                    </div>
                    <div class="stat-row">
                        <span>Peers</span> <span class="val" id="peerCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Block Height</span> <span class="val" id="blockHeight">0</span>
                    </div>
                    <div class="actions" style="margin-top: 20px;">
                        <button type="button" class="btn danger" onclick="resetSystem()">System Reset</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">Network Statistics</div>
                <div class="panel-body">
                    <div class="stat-row">
                        <span>Difficulty</span> <span class="val" id="netDiff">---</span>
                    </div>
                    <div class="stat-row">
                        <span>Reward</span> <span class="val" id="netReward">---</span>
                    </div>
                    <div class="stat-row">
                        <span>Next Halving</span> <span class="val" id="netHalving">---</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- CENTER COLUMN: WALLET & MINING -->
        <div class="column center-col">
            <div class="panel">
                <div class="panel-header">My Wallet</div>
                <div class="panel-body">
                    <div class="wallet-select-row">
                        <select id="walletSelect" onchange="updateWalletDisplay()">
                            <option value="">Loading Wallets...</option>
                        </select>
                        <button class="btn danger btn-icon" onclick="purgeWallet()" title="Purge Wallet">Ã—</button>
                    </div>

                    <div class="balance-display">
                        <span id="currentBalance">0.00</span>
                        <small>ICSI COINS</small>
                    </div>

                    <div class="address-display" id="currentAddress">---</div>

                    <div class="wallet-actions">
                        <button class="btn secondary small" onclick="openCreateWalletModal()">Create New</button>
                        <button class="btn secondary small" onclick="exportWallets()">Export</button>
                        <button class="btn secondary small" onclick="openImportWalletModal()">Import</button>
                    </div>

                    <div class="separator"></div>

                    <div class="send-form">
                        <div class="input-group">
                            <label>Recipient Address</label>
                            <input type="text" id="sendTo" placeholder="Paste address...">
                        </div>
                        <div class="input-group">
                            <label>Amount</label>
                            <input type="number" id="sendAmount" placeholder="0.00">
                        </div>
                        <button class="btn primary" onclick="sendCoin()">Send Coins</button>
                        <div id="sendResult" class="console-output small"></div>
                    </div>
                </div>
            </div>

            <!-- MINING SECTION -->
            <div class="panel">
                <div class="panel-header">Mining Operations</div>
                <div class="panel-body">
                    <div class="mining-controls">
                        <div class="input-group">
                            <label>Target Wallet</label>
                            <select id="miningTargetSelect">
                                <!-- Same as wallet list -->
                            </select>
                        </div>
                        <div class="actions-row">
                            <button class="btn success" id="startMineBtn" onclick="startMining()">Start Mining</button>
                            <button class="btn danger" id="stopMineBtn" onclick="stopMining()" disabled>Stop</button>
                        </div>
                    </div>

                    <div class="terminal-window" id="miningTerminal">
                        <div class="line">Ready to mine...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: TOPOLOGY -->
        <div class="column right-col">
            <div class="panel full-height">
                <div class="panel-header">Network Topology</div>
                <div class="panel-body">
                    <input type="text" id="peerSearch" placeholder="Search IP/Port..." onkeyup="filterPeers()"
                        style="margin-bottom: 10px;">

                    <div class="peer-list-container">
                        <table class="peer-table">
                            <thead>
                                <tr>
                                    <th>IP</th>
                                    <th>Port</th>
                                    <th>Status</th>
                                    <th>Act</th>
                                </tr>
                            </thead>
                            <tbody id="peerTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination">
                        <button onclick="prevPage()">&lt;</button>
                        <span id="pageInfo">1 / 1</span>
                        <button onclick="nextPage()">&gt;</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="createWalletModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                Name This Wallet
                <span class="close" onclick="closeModal('createWalletModal')">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="newWalletName" placeholder="e.g. Savings, Test 1...">
                <button class="btn primary" onclick="createWallet()" style="margin-top: 15px;">Generate Keys</button>
            </div>
        </div>
    </div>

    <div id="importWalletModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                Import Wallet JSON
                <span class="close" onclick="closeModal('importWalletModal')">&times;</span>
            </div>
            <div class="modal-body">
                <textarea id="importData" rows="5" placeholder='[{"private_key": "...", "name": "..."}]'></textarea>
                <button class="btn primary" onclick="importWallets()" style="margin-top: 15px;">Import</button>
            </div>
        </div>
    </div>

    <div id="logModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                Peer Logs
                <span class="close" onclick="closeModal('logModal')">&times;</span>
            </div>
            <div id="logContent" class="terminal-text"></div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
</body>

</html>